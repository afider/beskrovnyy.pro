---
// Welcome to Astro! Everything between these triple-dash code fences
// is your "component frontmatter". It never runs in the browser.

import BlogPostCard from '@components/BlogPostCard.astro';
import BaseLayout from '@layouts/BaseLayout.astro';
import TagsList from '@components/TagsList.astro';
import Pagination from '@components/Pagination.astro';
import { getImageUrl } from '@utils/GetImageUrl.astro';

const allPosts = await Astro.glob('../blog/*.mdx');
const postsPerPage = 4;

export async function getStaticPaths({paginate}) {
  const postsPerPage = 4;
  const allPosts = await Astro.glob('../blog/*.mdx');
  const formattedPosts = allPosts.sort((a, b) => Date.parse(b.frontmatter.date) - Date.parse(a.frontmatter.date));

  return paginate(formattedPosts, {
    pageSize: postsPerPage
  });
}

const {page} = Astro.props;
const pathname = new URL(Astro.request.url).pathname.split('/');
const firstPath = pathname[1];
const pageTitle = "–ë–ª–æ–≥";
---

<BaseLayout title={pageTitle}>

  <h1 class="article__title title title--h1">üçÑ –°—Ç–∞—Ç—å–∏ –æ –≤–µ–±-—Ä–∞–∑—Ä–∞–±—Ç–∫–µ, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö –∏ –∂–∏–∑–Ω–∏</h1>
  
  <aside class="article__aside aside">
    <h2 class="aside__title">üè∑Ô∏è –í—Å–µ —Ç–µ–≥–∏</h2>
    <div class="aside__body">
      <TagsList />
    </div>
  </aside>

  <div class="article__aside aside">
    <h2 class="aside__title">üìö –í—Å–µ —Å—Ç–∞—Ç—å–∏</h2>
    <div class="aside__body">
      <ul class="cards-grid">
        {
          page.data.map((post) => 
              <BlogPostCard 
                url={post.url} 
                title={post.frontmatter.title} 
                date={post.frontmatter.date} 
                dateUX={post.frontmatter.dateUX} 
                description={post.frontmatter.description}
                img={getImageUrl(post.frontmatter.coverImage)}
              />
            )
        }
      </ul>
    </div>
  </div>

  {allPosts.length > postsPerPage ? (
    <Pagination length={page.lastPage} 
      currentUrl={page.url.current} 
      currentPage={page.currentPage} 
      firstUrl={`/${firstPath}`} 
      prevUrl={page.url.prev} 
      nextUrl={page.url.next} 
      lastUrl={`/${firstPath}/${page.lastPage}`}
    />
  ) : null}

  <br>
  <br>
  <br>

</BaseLayout>
