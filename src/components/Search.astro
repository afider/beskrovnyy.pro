---
import { Sprite } from 'astro-icon';
---

<article class="search">
  <h2 class="search__title">Поиск</h2>
  <!-- <Sprite name="search" /> -->
  <input id="search" type="text" placeholder="Что будем-с искать?" class="search__control">
  <div id="search-results" class="search__results results" />

  <script is:inline>
    const searchField = document.querySelector('#search');
    searchField?.addEventListener('input', async (e) => {
      // only load the pagefind script once
      if (e.target.dataset.loaded !== 'true') {
        e.target.dataset.loaded = 'true'
        // load the pagefind script
        window.pagefind = await import("/pagefind/pagefind.js");
      }

      // search the index using the input value
      const search = await window.pagefind.search(e.target.value)
      const searchResults = document.querySelector('#search-results');

      // clear the old search-results
      searchResults.innerHTML = ''

      if(search.results.length !== 0) {
        // add the new search-results
      for (const result of search.results) {
        const data = await result.data();

        searchResults.innerHTML += `
          <a href="${data.url}" class="results__item">
            <h3 class="results__title">${data.meta.title}</h3>
            <p class="results__text">${data.excerpt}</p>
          </a>`
        
      }
      } else if (search.results.length === 0 && searchField.value != '') {
        searchResults.innerHTML += `
          <div class="results__empty">Ничего не найдено!</div>`
      }

    })
  </script>
</article>